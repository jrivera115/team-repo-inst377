<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="author" content="colorlib.com">
  <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" />
  <link href="css/main.css" rel="stylesheet" />


  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin="" />

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
    crossorigin=""></script>


</head>

<body>
  <div class="navigation">
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="documentation.html">Documentation</a></li>
        <li><a href="about.html">About Us</a></li>
      </ul>

  </div>
  <div class="s003">
    <form>
      <div class="form_head">
        <h1>SAFETY ZONE</h1>
      </div>
      <div class="inner-form">
        <div class="input-field second-wrap">
          <input id="search" type="text" name="inputs" placeholder="e.g. College Park" "">
          <!--use this input to filter the dataset-->
        </div>
        <div class="input-field third-wrap">
          <button class="btn-search" type="button" onclick="loadOption(document.getElementById('search').value)">
            <!--this line is not working when i use the loadOption()-->

            <svg class="svg-inline--fa fa-search fa-w-16" aria-hidden="true" data-prefix="fas" data-icon="search"
              role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="currentColor"
                d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z">
              </path>
            </svg>
          </button>
        </div>
        <div class="input-field third-wrap">
          <button class="btn-search" type="button"><a style="text-decoration:none" href="index.html">Reset</a></button>
        </div>
      </div>
    </form>
    <label class="switch">
      <input type="checkbox">
      <span class="slider round" onclick="changePlaceholder()"></span>
    </label>
  </div>
  <br>
  
  <div class="map_box">

    <div id="map" style="width: 90%; height: 600px;">

    </div>
  </div>
  <div class="content_test">
  </div>
  <script>
    function changePlaceholder() {
      var data = document.getElementById("search");
      if (data.placeholder === "e.g. College Park") {
        data.placeholder = "e.g. 20740";

      } else {
        data.placeholder = "e.g. College Park";

      }
      console.log(data);
      return data;

    }
    //creating the list of the food facilities based on the users' input
    function myList(res) {
      let ul = document.createElement("ul");

      for (let i = 0; i < res.length; i++) {

        let el = document.createElement("li");
        el.innerHTML = res[i];
        ul.appendChild(el);

      }
      document.querySelector('.content_test').appendChild(ul);
    }


    // this is the function that give option of how users can search food facilities based on city and zip code
    function loadOption(inputs) {
      var data = document.getElementById("search");
      if (data.placeholder === "e.g. College Park") {
        if (inputs === "") {
          alert('Please Enter A City')
        }
        else {
          loadDataCity(inputs);
          loadMap(inputs);
        };
      }
      if (data.placeholder === "e.g. 20740") {
        if (inputs === "") {
          alert('Please Enter A Zipcode')
        }
        else {
          loadDataZip(inputs);
          loadMap(inputs);
        };

      }
    }
    // load the food facilities list using the zip code
    function loadDataZip(inputs) {
      console.log('fetch'); // confirm code is running on click
      fetch('/api')
        .then(res => res.json())
        .then(res => res.data.filter(c => c.zip === inputs)) //will need to know how to retrieve input from users and use it to filter the data
        .then(res => res.map(c => [c.name,"<hr>",
                                  "Inspection Results: "+ c.inspection_results,
                                  "Date: "+ c.inspection_date.substr(0,10)].join('<br/>')))
        .then(res => {
          myList(res);
          console.log(res); // logging step to check what we got
          return res;
        });
    }
    // load the food facilities list using the city
    function loadDataCity(inputs) {
      console.log('fetch'); // confirm code is running on click
      fetch('/api')
        .then(res => res.json())
        .then(res => res.data.filter(c => c.city === inputs.toUpperCase())) //will need to know how to retrieve input from users and use it to filter the data
        .then(res => res.map(c => [c.name,"<hr>",
                                  "Inspection Results: "+ c.inspection_results,
                                  "Date: "+ c.inspection_date.substr(0,10)].join('<br/>')))
        .then(res => {
          myList(res);
          console.log(res); // logging step to check what we got
          return res;
        });
    }

    // loads map with markers of inputted city or zip code

    function loadMap(inputs) {
      console.log('fetch'); // confirm code is running on click
      fetch('/api')
        .then(res => res.json())
        .then(res => res.data.filter(c => c.city === inputs.toUpperCase() || c.zip === inputs)
        ) //will need to know how to retrieve input from users and use it to filter the data
        .then(res => res.map(c => [c.geocoded_column_1,c.name,[c.address_line_1,c.city,c.state,c.zip].join('<br/>')]))
        .then(res => {
          // myListMap(res);
          console.log(res); // logging step to check what we got

      var mymap = L.map("map").setView(res[0][0]["coordinates"].reverse(), 12); //setview based on a restaurant coordinate 
      L.tileLayer(
        "https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibXR1bmc4OCIsImEiOiJjazM5YmxmNXUwMDZ1M2pxcmtoeHh5OWx0In0.v3Sd-9s0tjXiAoRQ3tyzxQ",
        {
          attribution:
            'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          maxZoom: 15,
          id: "mapbox.streets"
        }
      ).addTo(mymap);

        
     // makes markers for each restaurant

      for (let i = 0; i < res.length; i++) {
        marker = new L.marker(res[i][0]["coordinates"].reverse()).bindPopup([res[i][1],res[i][2]].join('<br/>')).addTo(mymap); //[res[i][0]["coordinates"][1], res[i][0]["coordinates"][0]]
      }
      return mymap;
    });
    }

  </script>
</body>

</html>
